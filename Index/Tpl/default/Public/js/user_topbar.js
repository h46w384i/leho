pmc_in_script_time_6294=new Date()*1;(function(){var C=0,G,D;var A=function(J,I,H){if(J.attachEvent){J[I+H]=function(){return H.call(J,event);};J.attachEvent("on"+I,J[I+H]);}else{J.addEventListener(I,H,false);}return H;};var E=function(){if(window.postMessage){A(window,"message",B);}else{F(window,"name");}};var F=function(J,L){var K="";function I(M){var N=M.split("^").pop().split("&");return{domain:N[0],data:window.unescape(N[1])};}function H(){var M=J[L];if(M!=K){K=M;B(I(M));}}G=setInterval(H,1000/20);};var B=function(I){I=I||window.event;var J=unescape(I.data);var H=BB.StringH.queryUrl(J);D&&D(H);};E();window.CrossMsg={};CrossMsg.sendMessage=function(J,H){if(!J){return ;}if(typeof J!="object"){return ;}var I=BB.ObjectH.encodeURIJson(H);I=escape(I);if(window.postMessage){J.postMessage(I,"*");}else{J.name=(new Date()).getTime()+(C++)+"^"+document.domain+"&"+window.escape(I);}};CrossMsg.receiveMessage=function(H){D=H;};})();var User=function(){var H=BB.ObjectH,P=BB.CustEvent,I=BB.StringH,M=BB.EventH,E=BB.EventTargetH,D=BB.getScript,O=BB.Env,G=BB.NodeH.$;var L="http://i.leho.com";var C={SINA:L+"/psp/login/third/sina",QQ:L+"/psp/login/third/qq",RENREN:L+"/psp/login/third/renren",BAIDU:L+"/psp/login/third/baidu"};var N=function(){this.data=null;this.view=null;this._handles={};this._init.apply(this,arguments);this.logoutUrl="";};H.mix(N.prototype,{_init:function(Q){H.mix(this,Q,true);},logout:function(){location.href=this.logoutUrl;},login:function(S,R){var Q=this;R=R||{};Q.crossMsgCallback=function(T){if(T.isLogin){J.panel.hide();J.fire(B.EVENTS.login);}};this.data.complete(function(U){if(U.isLogin){S&&S(U);}else{var T={};H.mix(T,R,true);Q.view.renderLogin(T);Q.view.onlogin=function(){if(T.loginOk){User.Data._complete=false;T.loginOk();}else{if(/^http:\/\/www.leho.com/.exec(location.href)!=null){location.href="http://i.leho.com";}else{location.reload();}}};CrossMsg.receiveMessage(Q.crossMsgCallback);}});}});var B=function(){this.panel=null;this.data=null;this._init.apply(this,arguments);};B.EVENTS={login:"login",afterloginrender:"afterloginrender"};H.mix(B.prototype,{_init:function(S){var Q=[];for(var R in B.EVENTS){Q.push(R);}P.createEvents(this,Q);H.mix(this,S,true);},renderLogin:function(R){var Q=this;R=R||{};this._initPanel();this.panel.setCaption("登录");this.panel.setContent('<iframe src="'+__CONF__.psp_site_url+'/psp/mini/login" class="userLoginIframe" scrolling="auto" frameborder="0" width="540" height="370" allowtransparency="true"></iframe>');Q.panel.show();},_initPanel:function(){if(!this.panel){this.panel=new Dialog({className:"panel-t1 panel-login-new",width:540,center:true,footer:true,draggable:false,useIframe:true});}var Q=O.ie&&O.ie6;this.panel.setStyle("position",Q?"absolute":"fixed");}});var K=function(){H.mix(this,{_complete:false,_loading:false,_handlers:[],_data:{isLogin:false}});this._init.apply(this,arguments);};H.mix(K.prototype,{siteUrl:L+"/data/sns_topbar?t="+new Date().getTime(),_init:function(Q){P.createEvents(this,"change");H.mix(this,Q,true);},_boolean:function(Q){return Q==0?false:true;},_callBack:function(){var Q=this;if(Q._loading){return ;}Q._loading=true;Q._complete=false;D(this.siteUrl,null,{charset:"gb2312"});},_process:function(U){var Q=this;Q._loading=false;Q._complete=true;Q._data.isLogin=Q._boolean(U.data.is_login);if(Q._data.isLogin){Q._data.loginName=U.data.uname;}for(var S=0,R=this._handlers.length;S<R;S++){this._dispatch(this._handlers[S]);}this._handlers=[];var T=new P(this,"change");T.info={isLogin:this._data.isLogin,loginName:this._data.loginName};this.fire(T);},_dispatch:function(Q){Q.call(null,{isLogin:this._data.isLogin,loginName:this._data.loginName});},complete:function(Q){if(this._complete){this._dispatch(Q);}else{this._handlers.push(Q);this._callBack();}},updata:function(){this.clear();this._callBack();},clear:function(){this._complete=false;}});var F=new K,J=new B({data:F}),A=new N({data:F,view:J});return{Data:F,View:J,Power:A};}();pmc_exec_time_6294=new Date()*1-pmc_in_script_time_6294;
