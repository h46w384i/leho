pmc_in_script_time_9103=new Date()*1;(function(){var H,N=0,b=0,Q=[],K=[];var J=BB.Tmpl('<div class="up-pic" id="{opts.imid}" data-width="{opts.width}" data-height="{opts.height}"><div class="pic"><img src="{get_img(opts.imid, {w:144,h:108,imtype:12 })}" id="{opts.fileid}"/><a href="#" onclick="return false" class="del"></a></div><input placeholder="为图片说点什么吧" type="text" value="{opts.desc}" class="txt"></div>');var F='<div class="up-pic unupload-image"><div class="pic"><img src="'+upload_config.res_site_url+'/sp/sns/publish/css/images/load2.gif"/></div><input placeholder="为图片说点什么吧" type="text" value="" class="txt"></div>';var a={file_post_name:"userfile",flash_url:upload_config.swf_url,upload_url:upload_config.upload_url,file_types:"*.jpg;*.gif;*.png",file_types_description:"Web Image Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{progressTarget:"fsUploadProgress",cancelButtonId:"btnCancel"},prevent_swf_caching:true,debug:false,button_image_url:upload_config.res_site_url+"/sp/sns/publish/css/images/add-btn-small.gif",button_width:"104",button_height:"32",button_placeholder_id:"add_pic",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.OPAQUE,file_dialog_start_handler:V,file_queued_handler:Y,file_queue_error_handler:D,file_dialog_complete_handler:M,upload_start_handler:R,upload_progress_handler:C,upload_error_handler:B,upload_success_handler:L,upload_complete_handler:Z,swfupload_loaded_handler:I};_title=document.title;H=new SWFUpload(a);function I(){document.title=_title;}function V(){if(typeof (__CONF__)!="undefined"&&typeof (__CONF__.login_uid)!="undefined"){H.addPostParam("uid",__CONF__.login_uid);}}function Y(c){K[K.length]=c;}function D(d,f,e){try{if(f===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("只能上传8张图片");return ;}switch(f){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:break;default:break;}}catch(c){this.debug(c);}}function M(h,j){if((K.length+N)>8){K.forEach(function(i){H.cancelUpload(i.id);});K.clear();MessageBox.alert({caption:"每条分享最多只能上传8张照片",buttons:[]});}else{for(var e=0;e<K.length;e++){var d=K[e];if(d.size>10485760){H.cancelUpload(d.id);Q[Q.length]=d.name+"　"+(d.size/1048576).toFixed(2)+"M";}else{if(N==0){W("#img_list .re-up-pic").removeClass("re-up-pic");W($("upload_tips")).hide();H.setButtonImageURL(upload_config.res_site_url+"/sp/sns/publish/css/images/add-btn-big.gif");H.setButtonDimensions("144","108");}if(N<7){var f=F;var l=DomU.create(f);var g=W($("img_list"));var c=g.lastChild(".up-pic");g.insertBefore(l,c);}else{if(N==7){H.setButtonImageURL(upload_config.res_site_url+"/sp/sns/publish/css/images/load3.gif");H.setButtonDisabled(true);H.setButtonCursor(SWFUpload.CURSOR.ARROW);var k=DomU.create('<input placeholder="为照片说点什么吧" type="text" value="" class="txt">');var g=W($("img_list"));var c=g.lastChild(".up-pic");c.appendChild(k);}else{H.cancelUpload(d.id);}}if(N<8){N++;}}}K.clear();}if(Q.length>0){MessageBox.alert({caption:"有"+Q.length+"张图片大于10M,未上传成功",buttons:[]});Q.clear();}this.startResizedUpload(null,800,800,SWFUpload.RESIZE_ENCODING.JPEG,80,false);}function R(c){}function C(d,c,e){}function B(e,g,f){try{var d=new FileProgress(e,this.customSettings.progressTarget);d.setError();d.toggleCancel(false);switch(g){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:d.setStatus("Upload Error: "+f);this.debug("Error Code: HTTP Error, File name: "+e.name+", Message: "+f);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:d.setStatus("Upload Failed.");this.debug("Error Code: Upload Failed, File name: "+e.name+", File size: "+e.size+", Message: "+f);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:d.setStatus("Server (IO) Error");this.debug("Error Code: IO Error, File name: "+e.name+", Message: "+f);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:d.setStatus("Security Error");this.debug("Error Code: Security Error, File name: "+e.name+", Message: "+f);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:d.setStatus("Upload limit exceeded.");this.debug("Error Code: Upload Limit Exceeded, File name: "+e.name+", File size: "+e.size+", Message: "+f);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:d.setStatus("Failed Validation.  Upload skipped.");this.debug("Error Code: File Validation Failed, File name: "+e.name+", File size: "+e.size+", Message: "+f);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:if(this.getStats().files_queued===0){document.getElementById(this.customSettings.cancelButtonId).disabled=true;}d.setStatus("Cancelled");d.setCancelled();break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:d.setStatus("Stopped");break;default:d.setStatus("Unhandled Error: "+g);this.debug("Error Code: "+g+", File name: "+e.name+", File size: "+e.size+", Message: "+f);break;}}catch(c){this.debug(c);}}function L(e,f){var g=Ajax.opResults(f,false);g.fileid=e.id;g.imid=g.id;var c=get_img(g.id,{w:144,h:108,imtype:12});b++;var l=W("#img_list .unupload-image");if(l.length!=0){var k=l.first();k.query(" img").setAttr("src",c);del_dom=DomU.create('<a href="#" onclick="return false" class="del"></a>');k.query(" .pic").appendChild(del_dom);k.setAttr("id",g.id);k.setAttr("data-width",g.width);k.setAttr("data-height",g.height);k.removeClass("unupload-image");}else{var h=J(g);var j=DomU.create(h);var i=W($("img_list"));var d=i.lastChild(".up-pic");H.destroy();i.removeChild(d);i.appendChild(j);}PublishUpload.afterUpload("uploadSuccess");}function Z(){try{if(this.getStats().files_queued===0){}else{this.startResizedUpload(null,800,800,SWFUpload.RESIZE_ENCODING.JPEG,80,false);}}catch(c){this.debug(c);}}function S(){if(!BB.Env.ie){if(b<8&&b!=0){var d=W($("img_list"));var h=W("#img_list .up-pic");var g=[];N=b;for(var f=b,c=h.length;f<c;f++){g.push(h[f]);}g.forEach(function(i){d.removeChild(i);});H.destroy();var j={file_post_name:"userfile",flash_url:upload_config.swf_url,upload_url:upload_config.upload_url,file_types:"*.jpg;*.gif;*.png",file_types_description:"Web Image Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{progressTarget:"fsUploadProgress",cancelButtonId:"btnCancel"},debug:false,prevent_swf_caching:true,button_image_url:upload_config.res_site_url+"/sp/sns/publish/css/images/add-btn-big.gif",button_width:"144",button_height:"108",button_placeholder_id:"add_pic",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.OPAQUE,file_dialog_start_handler:V,file_queued_handler:Y,file_queue_error_handler:D,file_dialog_complete_handler:M,upload_start_handler:R,upload_progress_handler:C,upload_error_handler:B,upload_success_handler:L,upload_complete_handler:Z,swfupload_loaded_handler:I};var e=DomU.create('<div class="up-pic"><a id="add_pic"></a></div>');W($("img_list")).appendChild(e);_title=document.title;H=new SWFUpload(j);}}}function P(){if(BB.Env.ie6){var c={file_post_name:"userfile",flash_url:upload_config.swf_url,upload_url:upload_config.upload_url,file_types:"*.jpg;*.gif;*.png",file_types_description:"Web Image Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{progressTarget:"fsUploadProgress",cancelButtonId:"btnCancel"},debug:false,prevent_swf_caching:true,button_image_url:upload_config.res_site_url+"/sp/sns/publish/css/images/add-btn-small.gif",button_width:"104",button_height:"32",button_placeholder_id:"add_pic",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.OPAQUE,file_dialog_start_handler:V,file_queued_handler:Y,file_queue_error_handler:D,file_dialog_complete_handler:M,upload_start_handler:R,upload_progress_handler:C,upload_error_handler:B,upload_success_handler:L,upload_complete_handler:Z,swfupload_loaded_handler:I};W($("img_list")).html('<div class="up-pic re-up-pic"><a id="add_pic"></a></div><span class="gray" id="upload_tips">可按住Ctrl批量上传图片，最多不超过8张</span>');H=new SWFUpload(c);}}function X(f){if(f.length>0){b=f.length;N=f.length;if(f.length<8){var d="";for(var e=0,c=f.length;e<c;e++){d+=J(f[e]);}W($("upload_tips")).hide();var g={file_post_name:"userfile",flash_url:upload_config.swf_url,upload_url:upload_config.upload_url,file_types:"*.jpg;*.gif;*.png",file_types_description:"Web Image Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{progressTarget:"fsUploadProgress",cancelButtonId:"btnCancel"},debug:false,prevent_swf_caching:true,button_image_url:upload_config.res_site_url+"/sp/sns/publish/css/images/add-btn-big.gif",button_width:"144",button_height:"108",button_placeholder_id:"add_pic",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.OPAQUE,file_dialog_start_handler:V,file_queued_handler:Y,file_queue_error_handler:D,file_dialog_complete_handler:M,upload_start_handler:R,upload_progress_handler:C,upload_error_handler:B,upload_success_handler:L,upload_complete_handler:Z,swfupload_loaded_handler:I};H.destroy();W($("img_list")).insertAdjacentHTML("afterbegin",d);W("#img_list .re-up-pic").html('<a id="add_pic"></a>');_title=document.title;H=new SWFUpload(g);W("#img_list .re-up-pic").removeClass("re-up-pic");}else{H.destroy();var d="";for(var e=0,c=f.length;e<c;e++){d+=J(f[e]);}W($("upload_tips")).hide();W($("img_list")).removeChild(W("#img_list .re-up-pic").first());W($("img_list")).insertAdjacentHTML("afterbegin",d);}}PublishUpload.afterUpload("add");}function G(g){var d=g;W($("img_list")).removeChild(d);var c=W("#img_list .up-pic");if(N==8){if(b==8){var j={file_post_name:"userfile",flash_url:upload_config.swf_url,upload_url:upload_config.upload_url,file_types:"*.jpg;*.gif;*.png",file_types_description:"Web Image Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{progressTarget:"fsUploadProgress",cancelButtonId:"btnCancel"},debug:false,prevent_swf_caching:true,button_image_url:upload_config.res_site_url+"/sp/sns/publish/css/images/add-btn-big.gif",button_width:"144",button_height:"108",button_placeholder_id:"add_pic",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.OPAQUE,file_dialog_start_handler:V,file_queued_handler:Y,file_queue_error_handler:D,file_dialog_complete_handler:M,upload_start_handler:R,upload_progress_handler:C,upload_error_handler:B,upload_success_handler:L,upload_complete_handler:Z,swfupload_loaded_handler:I};var e=DomU.create('<div class="up-pic"><a id="add_pic"></a></div>');W($("img_list")).appendChild(e);H.destroy();_title=document.title;H=new SWFUpload(j);}else{H.setButtonImageURL(upload_config.res_site_url+"/sp/sns/publish/css/images/add-btn-big.gif");H.setButtonDisabled(false);H.setButtonCursor(SWFUpload.CURSOR.HAND);var h=c.last().query(" .txt").first().getValue();var f=DomU.create(F);W($("img_list")).insertBefore(f,c.last());c.last().removeChild(c.last().query(" .txt").first());}}if(N==1){var i={file_post_name:"userfile",flash_url:upload_config.swf_url,upload_url:upload_config.upload_url,file_types:"*.jpg;*.gif;*.png",file_types_description:"Web Image Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{progressTarget:"fsUploadProgress",cancelButtonId:"btnCancel"},debug:false,prevent_swf_caching:true,button_image_url:upload_config.res_site_url+"/sp/sns/publish/css/images/add-btn-small.gif",button_width:"104",button_height:"32",button_placeholder_id:"add_pic",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.OPAQUE,file_dialog_start_handler:V,file_queued_handler:Y,file_queue_error_handler:D,file_dialog_complete_handler:M,upload_start_handler:R,upload_progress_handler:C,upload_error_handler:B,upload_success_handler:L,upload_complete_handler:Z,swfupload_loaded_handler:I};W($("img_list")).html('<div class="up-pic re-up-pic"><a id="add_pic"></a></div><span class="gray" id="upload_tips">可按住Ctrl批量上传图片，最多不超过8张</span>');_title=document.title;H=new SWFUpload(i);}N--;b--;PublishUpload.afterUpload("del");}function T(){b=0;N=0;var c={file_post_name:"userfile",flash_url:upload_config.swf_url,upload_url:upload_config.upload_url,file_types:"*.jpg;*.gif;*.png",file_types_description:"Web Image Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{progressTarget:"fsUploadProgress",cancelButtonId:"btnCancel"},debug:false,prevent_swf_caching:true,button_image_url:upload_config.res_site_url+"/sp/sns/publish/css/images/add-btn-small.gif",button_width:"104",button_height:"32",button_placeholder_id:"add_pic",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.OPAQUE,file_dialog_start_handler:V,file_queued_handler:Y,file_queue_error_handler:D,file_dialog_complete_handler:M,upload_start_handler:R,upload_progress_handler:C,upload_error_handler:B,upload_success_handler:L,upload_complete_handler:Z,swfupload_loaded_handler:I};W($("img_list")).html('<div class="up-pic re-up-pic"><a id="add_pic"></a></div><span class="gray" id="upload_tips">可按住Ctrl批量上传图片，最多不超过8张</span>');_title=document.title;H=new SWFUpload(c);PublishUpload.afterUpload("clear");}function A(){var d=W("#img_list .up-pic");var c=[];d.forEach(function(e){var f=W(e);if(f.getAttr("id")){c.push({img_id:f.getAttr("id"),img_name:f.query(" .txt").first().getValue(),img_width:f.getAttr("data-width"),img_height:f.getAttr("data-height")});}});return c;}function E(){var c=W("#img_list .up-pic");return c&&c.length>1;}function O(c){c=c||"";var f=A();var e=W($("consume_form"));e.query(" .upload_image").forEach(function(h,g){e.removeChild(h);});for(var d=0;d<f.length;d++){e.appendChild(DomU.create('<input class="upload_image" type="hidden" name="image_id{0}" value="{1}" />'.format(d,f[d].img_id)));e.appendChild(DomU.create('<input class="upload_image" type="hidden" name="image_name{0}" value="{1}" />'.format(d,f[d].img_name)));e.appendChild(DomU.create('<input class="upload_image" type="hidden" name="image_width{0}" value="{1}" />'.format(d,f[d].img_width)));e.appendChild(DomU.create('<input class="upload_image" type="hidden" name="image_height{0}" value="{1}" />'.format(d,f[d].img_height)));}e.appendChild(DomU.create('<input type="hidden" class="upload_image" name="image_count" value="{0}" />'.format(f.length)));PublishUpload.afterUpload("insert");}BB.provide("PublishUpload",{reDraw:S,getUploadImage:A,insertImagesForPublish:O,addPicture:X,delPicture:G,clearImage:T,q_num:function(){return N;},u_num:function(){return b;},hasImage:E,reDraw4IE6:P,afterUpload:function U(c){}});}());pmc_exec_time_9103=new Date()*1-pmc_in_script_time_9103;
