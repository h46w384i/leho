pmc_in_script_time_2048=new Date()*1;function later(B,A){A=A||200;var D=function(){B();};var C=setTimeout(D,A);return{cancel:function(){clearTimeout(C);}};}var CommonCard=function(){var F=BB.ObjectH,E=BB.EventTargetH,H=BB.Env,D=BB.Helper,G=BB.NodeH,A=null,C=function(){this.core=null;this.className="panel panel-t3 panel-t3-bl card-panel";this.leave_timer=null;this.enter_timer=null;this.init.apply(this,arguments);};C.popup=null;C.url="/card/{0}";C.hasShowed=false;C.unfollow='<a href="javascript:;" class="follow-business-circle btn-add-group" data-district_id="{0}"><span>关注该商圈</span></a>';C.followed='<div class="btn-follow-26-end cancel-follow"><span>已关注</span><a href="javascript:;" data-district_id="{0}" class="unfollow-business-circle">取消</a></div>';F.mix(C.prototype,{init:function(B){F.mix(this,B||{},true);this._bindEvent();},_bindEvent:function(){var B=this;W(document.body).delegate(".placecard","mouseover",function(){var I=this;B.leave_timer&&B.leave_timer.cancel();B.enter_timer=later(function(){B.show(I);});}).delegate(".placecard","mouseout",function(){B.enter_timer&&B.enter_timer.cancel();B.leave_timer=later(function(){!C.hasShowed&&B.hide();});});W(document.body).delegate(".unfollow-business-circle","click",function(){B.unFollowDistrict(this.getAttribute("data-district_id"));}).delegate(".follow-business-circle","click",function(){B.followDistrict(this.getAttribute("data-district_id"));});},show:function(N){var I=this;var K=N.getAttribute("data-plid");var J=N.getAttribute("data-place-x");var L=N.getAttribute("data-place-y");var M=N.getAttribute("data-place-name");if(!C.popup){C.popup=new LayerPopup({className:I.className,header:false,useIframe:true,shadow:true,cue:true,corner:true,autoPosition:false});}var B={_of:"json",tmp:new Date().getTime(),plid:K,place_x:J,place_y:L,place_name:M};Ajax.get(C.url.format("getPlaceCard"),B,function(T){var P=Ajax.opResults(T,false);if(P.err=="mcphp.ok"){var O=P.data.view;var R=C.popup.setContent(O);C.popup.show(0,0,null,null,I.core);var Q=W(R).getSize().height;var S=W(R).query(".error-panerl").first();if(S){Q+=parseInt(S.getCurrentStyle("margin-top"),10)*2;W(R).parentNode(".card-panel").addClass("cue-white");}else{Q+=10;W(R).parentNode(".card-panel").removeClass("cue-white");}C.popup.show(0,-(Q+15),null,null,N);if(J!="0"&&L!="0"){I.renderMap(J,L,M);}W(".card-panel").on("mouseenter",function(U){C.hasShowed=true;}).on("mouseleave",function(){var U=this;later(function(){W(U).hide();C.hasShowed=false;});});}});},hide:function(){if(C.popup){C.popup.hide();}},renderMap:function(B,N,M){var J=W("#map_card_container");if(J){var I=B/1000000;var K=N/1000000;var L=new ShopMap.Thumbnail("map_card_container",new BMap.Point(I,K),{zoomLevel:15,shopName:M});L.getMap().centerAndZoom(new BMap.Point(I,K,15));}},followDistrict:function(B){Ajax.post("/home/_addDistrict",{_of:"json",tmp:new Date().getTime(),"district_id[]":B},function(J){var I=Ajax.opResults(J,false);if(I.err=="mcphp.ok"){W(".actions").html(C.followed.format(B));}});},unFollowDistrict:function(B){Ajax.post("/profile/_cancelAttentionPlace",{_of:"json",tmp:new Date().getTime(),district_id:B},function(J){var I=Ajax.opResults(J,false);if(I.err=="mcphp.ok"){W(".actions").html(C.unfollow.format(B));}});}});return C;}();var initCard=function(A,B){A=A||initCard.config.className;new CommonCard(B);};initCard.config={className:"placecard"};initCard();pmc_exec_time_2048=new Date()*1-pmc_in_script_time_2048;
