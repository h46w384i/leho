pmc_in_script_time_4330=new Date()*1;var LifeShare=function(){var B={},D=null,P=null,M=true;var R={LIMIT:'<div class="count-txt">还可以输入<span class="txt">{0}</span>字</div>',OVER:'<div class="count-txt error">超出<span class="txt">{0}</span>字</div>',TOPIC:'<a data-type="insert" class="consume-hot-topic hot" data-text="#{0}#" href="javascript:;">{0}</a>'};var L={count:50,tag:"@"};var S=false;var E=W("#consume_txt_con");var F=W("#consume_btn");var V=W("#address_clear");var U=function(Z){E.html(R.LIMIT.format(Z));if(Z<=L.count){E.show("block");}else{E.hide();}};var N=function(Z){E.show("block").html(R.OVER.format(Z));};var H=function(b){var Z=b.date,a=b.type;Timeline.publishFeedToTimeline(Z.split("-")[0]+"-"+parseInt(Z.split("-")[1],10),function(){MessageBox.tips({caption:a=="edit"?"编辑成功":"发布成功"});});G_dialog.hide();};var I=function(b){var Z=b.post_id;var a=b.feed||"";HomePublish.postSuccess(Z,a);G_dialog.hide();};var T=function(){F.replaceClass("btn-t1","btn-default-32");F.query("span").html("发布中...");};var O=function(){if(S){return false;}if(D.getGuard()){if(Valid.checkAll($("consume_form"))){if(D.checkGuard()==0){D.core.value="分享图片";}S=true;T();PublishUpload.insertImagesForPublish();Ajax.post($("consume_form"),function(c){S=false;var a=Ajax.opResults(c,false);if(a.err=="mcphp.ok"){var b=a.data;var Z=b.type&&b.type=="edit";B.reset();switch(PREFIX){case"profile":H(b);break;case"home":I(b);break;default:G_dialog.hide();MessageBox.tips({caption:"发布成功"});Z&&PostDetail.editSuccess();break;}}else{if(a.err=="mcphp.u_antispam"){W("#consume_textarea").shine4Error();F.replaceClass("btn-default-32","btn-t1");F.query("span").html("发布");}else{if(a.err=="memcacheq.sys_inter"){MessageBox.tips({caption:"发布成功"});}else{B.reset();}}}});}}else{W("#consume_textarea").shine4Error();}};var G=function(){var a=$("consume_textarea");var Z=L.tag.length;textAreaUtilsFacade.insertText(a,L.tag);};var K=function(){D=new PublishEditor("consume_textarea",{limitCount:2000});D.checkGuard=function(){var b=0;return function(c,d){if(arguments.length!=0){if(c&&(d>0||PublishUpload.hasImage())){b=d;return true;}else{b=-1;return false;}}else{return b;}};}();P=new PublishTopic();P.blankTopic=DomU.query(".consume-blank-topic");var Z=new AtFriends();var a=new PublishFace();D.addWidgets(a);D.addWidgets(P);D.addWidgets(Z);D.on("unovercount",function(b){U(b.count);});D.on("overcount",function(b){N(b.count);});D.on("cancelpublish",function(){F.replaceClass("btn-t1","btn-default-32");});D.on("canpublish",function(b){F.replaceClass("btn-default-32","btn-t1");});D.render();F.click(function(){O();});$("consume_at_btn").onclick=function(){G();};W("i.consume_showin_timeline").click(function(){Q(W(this));});W("span.consume_showin_timeline").click(function(){Q(W("i.consume_showin_timeline"));});W($("img_list")).delegate(" .del","click",function(b){b.preventDefault();pic=W(this).parentNode(".up-pic");PublishUpload.delPicture(pic);});PublishUpload.afterUpload=function(b){if(b=="uploadSuccess"||b=="add"||b=="del"){D.core.focus();}};};var Q=function(Z){M=!M;Z.toggleClass("checked","checkbox");if(M){W("#consume_showTimeline").val("1");}else{W("#consume_showTimeline").val("0");}};var C=function(b){var c=b.sh_id,d=W("#topic_tips"),a=W("#tag_wrap"),Z=[];if(c=="0"){d.hide();}else{Ajax.get("/publish/searchTopic",{_of:"json",r:new Date().getTime(),sh_id:c},function(n){var j=Ajax.opResults(n,false);if(j.err=="mcphp.ok"){var m=j.data.topics;if(m.length==0){return false;}var h=m[0].feature;if(h.length==0){return false;}var f=h.split("、");for(var k=0,g=f.length;k<g;k++){Z.push(R.TOPIC.format(f[k]));}a.html(Z.join(""));d.show("block");}});}};B.setPlaceSelected=function(){W("#address-sug-input").addClass("gray").set("disabled","disabled");W("#address_clear").show();};var Y=function(Z){B.setPlaceSelected();$("pl_id").value=Z.plid;C(Z);};var J=function(Z){W("#address-sug-input").val("").set("disabled",false).removeClass("gray").focus();Z.hide();$("pl_id").value="";W("#topic_tips").hide();};var X=function(){var Z=window.plSug=new BB.Suggest.Sns({url:"/search/plsug?keyword={$query}&_ie=utf-8",template:'<div><div class="address-pos container-item{if($data.length > 5)} address-height{/if}"><ul class="cls">{for (var i=0;i<$data.length;i++)}<li class="item listview-item"><div class="type"><img src="'+__CONF__.img_url+"/img_new/"+__CONF__.place_img+'--30-30-1" alt="地点"/></div><h3>{$data[i].key}</h3><p>{$data[i].place_addr_hilight}</p></li>{/for}</ul></div><a href="" class="more">使用<strong>"{$data.keyword}"</strong></a></div>',target:NodeW("#address-sug-input"),container:W("#address-list")});Z.get("view").on("itemselect",function(b){Y(b.data);});var a=Z.get("combo");a.get("layer").delegate(".more","click",function(b){b.preventDefault();a.hide();});V.click(function(){J(W(this));}).on("mouseover",function(){W(this).replaceClass("X","X-hover");}).on("mouseout",function(){W(this).replaceClass("X-hover","X");});};var A=function(){var Z=W(".publish-bar .share-list i"),d=W("#share_tip"),c=W("#share_tip .share-tips"),a=($("third_type")&&$("third_type").value.trim())||0,b={qq:"QQ空间",sina:"sina微博",renren:"人人网"};if(a&14){Z.on("click",function(g){var f=this.className,h=this.getAttribute("data-v");if(f.indexOf("-lighted")!=-1){W(this).replaceClass(f,f.split("-")[0]);W("#third_type").val("");c.setHtml("点击后开启同步");}else{W(this).replaceClass(f,f+"-lighted");W("#third_type").val(this.getAttribute("data-type"));c.setHtml("点击后取消同步");}});}Z.on("mouseover",function(){var f=this.getAttribute("data-v"),e=this.className.indexOf("-lighted");d.css("display","block");if(e!=-1){c.setHtml("点击后取消同步");}else{c.setHtml("点击后开启同步");}});Z.on("mouseout",function(){var e=this.getAttribute("data-v");d.css("display","none");});};B.reset=function(){PublishUpload.clearImage();$("consume_textarea").value="";$("address-sug-input").value="";$("inp_price").value="";$("pl_id").value="";$("address_clear").style.display="none";W("#address-sug-input").set("disabled",false).removeClass("gray").val("");F.query("span").html("发布");F.replaceClass("btn-t1","btn-default-32");D.setGuard(false);B.setSameShowInTimeline();};B.setSameShowInTimeline=function(){W("i.consume_showin_timeline").replaceClass("checkbox","checked");W("#consume_showTimeline").val("1");B.setSameShowInTimelineSate(true);};B.hasContent=function(){var a=$("consume_textarea").value!="";var Z=$("address-sug-input").value!="";var b=$("inp_price").value!="";return(a||Z||b);};B.setSameShowInTimelineSate=function(Z){M=Z;};B.init=function(){K();X();A();};return B;}();LifeShare.init();pmc_exec_time_4330=new Date()*1-pmc_in_script_time_4330;
