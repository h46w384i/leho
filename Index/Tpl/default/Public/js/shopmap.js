pmc_in_script_time_4396=new Date()*1;pmc_in_script_time_2750=new Date()*1;(function(){var A=window.ShopMap={};ObjectH.mix(A,{markerImage:"http://ditu.baidu.com/img/markers.png",defaultCenter:new BMap.Point(116.404,39.915),defaultCity:"北京市",shopInfoClass:{name:"map-shop-name",address:"map-shop-address",shopInfo:"panel-map-info",phone:"map-shop-phone"},minHeight:300});var E=function(I,H,F){this.cid=I;H=H||A.defaultCenter;ObjectH.mix(this,{zoomLevel:15,shopName:null,shopAddress:null,shopPhone:null,city:A.defaultCity});ObjectH.mix(this,F,true);this._beforeInit();this.map=new BMap.Map(this.cid);var G=this;this.setCenter(H,function(){G._init();});};E.prototype={_beforeInit:function(){},_init:function(){},setCenter:function(G,H){if(typeof G!="string"){this.map.centerAndZoom(G,this.zoomLevel);this.center=G;if(this.marker){this.marker.setPoint(this.center);}if(this._vmarker){this._vmarker.setPoint(this.center);}H&&H(G);}else{var F=this;if(!this._geo){this._geo=new BMap.Geocoder();}this._geo.getPoint(G,function(I){var J=I||A.defaultCenter;F.map.centerAndZoom(J,F.zoomLevel);F.center=J;if(F.marker){F.marker.setPoint(F.center);}if(F._vmarker){F._vmarker.setPoint(F.center);}H&&H(I);},F.city);}},setShopInfo:function(){if(!this.shopName){return ;}try{var F=$(this.cid).parentNode.parentNode;Dom.query("."+A.shopInfoClass.name,F)[0].innerHTML=this.shopName;Dom.query("."+A.shopInfoClass.address,F)[0].innerHTML=this.shopAddress;Dom.query("."+A.shopInfoClass.phone,F)[0].innerHTML=this.shopPhone;}catch(G){}},getMap:function(){return this.map;},getMarker:function(){return this.marker;},adjustToView:function(){var F=$(this.cid).parentNode.parentNode,I=30+31;if(F){var G=Dom.query("."+A.shopInfoClass.shopInfo,F)[0];if(G){I+=G.offsetHeight;}}var J=Dom.getDocRect().height,H=J-I;H=H<A.minHeight?A.minHeight:H;$(this.cid).style.height=H+"px";}};var D=A.Thumbnail=ClassH.extend(function(){},E);ObjectH.mix(D.prototype,{_init:function(){var F=new BMap.Icon(A.markerImage,new BMap.Size(23,25),{imageOffset:new BMap.Size(0,0-11*25)});this.marker=new BMap.Marker(this.center,{icon:F});this.marker.setTitle(this.shopName);this.map.centerAndZoom(this.center,this.zoomLevel);this.map.addOverlay(this.marker);this.map.enableScrollWheelZoom();}},true);var C=A.ModifyView=ClassH.extend(function(){},E);ObjectH.mix(C,{okButtonID:"modifyMapOkButton",cancelButtonID:"modifyMapCancelButton",confirmID:"mapPopupConfirm",remindID:"mapPopupRemind",popupID:"mapPopupWindow"});C.confirmHTML='<div id="'+C.popupID+'"><div id="'+C.remindID+'" class="content">您可以拖动此图标在地图上标注店铺位置。</div><div id="'+C.confirmID+'" style="display:none"><div class="content">是否将新位置设置为商户的默认位置？</div><div class="act"><button id="'+C.okButtonID+'" type="button" class="ok-button">是</button>&nbsp;&nbsp;<button id="'+C.cancelButtonID+'" type="button" class="cancel-button">否</button></div></div></div>';ObjectH.mix(C.prototype,{_beforeInit:function(){this.setShopInfo();this.adjustToView();},_init:function(){var H=this;this.infoWindowState=1;var I=new BMap.Icon(A.markerImage,new BMap.Size(23,25),{imageOffset:new BMap.Size(0,0-27*25+3)});this.marker=new BMap.Marker(this.center,{icon:I});window.map=this.map;this.marker.enableDragging(true);this.inDragging=false;this.lastDragStartPoint=this.center;this.marker.addEventListener("dragstart",function(K){H.lastDragStartPoint=H.marker.getPoint();H.inDragging=true;if(!H._vmarker){var J=new BMap.Icon(A.markerImage,new BMap.Size(23,25),{imageOffset:new BMap.Size(0,0-11*25)});H._vmarker=new BMap.Marker(H.center,{icon:J});H.map.addOverlay(H._vmarker);}H.marker.setTop(true);H.marker.closeInfoWindow();});this.marker.addEventListener("dragend",function(J){if(!H.inDragging){return ;}H.inDragging=false;H.showConfirmInfoWIndow();});this.confirmWindow=new BMap.InfoWindow(C.confirmHTML,{offset:new BMap.Size(0,-8),width:240});function F(){this.marker.enableDragging(true);this.windowInConfirm=false;this.marker.closeInfoWindow();this.marker.setPoint(this.lastDragStartPoint);}this.windowInConfirm=false;this.confirmWindow.addEventListener("close",function(J){if(H.windowInConfirm){F.call(H);}H.windowInConfirm=false;});this.map.centerAndZoom(this.center,this.zoomLevel);this.map.enableScrollWheelZoom();this.map.addOverlay(this.marker);this.map.addOverlay(this.confirmWindow);this.map.addControl(new BMap.NavigationControl());this.marker.openInfoWindow(this.confirmWindow);function G(K){var L=K.target,J=$$(L).get("className");if(J=="ok-button"){H.windowInConfirm=false;H.marker.closeInfoWindow();H.point=H.marker.getPoint();H._vmarker.setPoint(H.point);H.center=H.point;H.onSelect&&H.onSelect(H.point);}else{if(J=="cancel-button"){F.call(H);}}}this.confirmWindow.addEventListener("open",function(J){if(H.infoWindowState==1){$$(C.remindID)&&$$(C.remindID).show();$$(C.confirmID)&&$$(C.confirmID).hide();}else{$$(C.remindID)&&$$(C.remindID).hide();$$(C.confirmID)&&$$(C.confirmID).show();}$$(C.popupID).un("click",G);$$(C.popupID).on("click",G);});},showBeginInfoWIndow:function(){this.infoWindowState=1;this.marker.openInfoWindow(this.confirmWindow);},showConfirmInfoWIndow:function(){this.infoWindowState=2;this.windowInConfirm=true;this.marker.openInfoWindow(this.confirmWindow);},minusHeight:170},true);var B=A.HugeView=ClassH.extend(function(){},E);ObjectH.mix(B.prototype,{_beforeInit:function(){this.setShopInfo();this.adjustToView();},_init:function(){var F=this;var G=new BMap.Icon(A.markerImage,new BMap.Size(23,25),{imageOffset:new BMap.Size(0,0-11*25)});this.marker=new BMap.Marker(this.center,{icon:G});this.map.centerAndZoom(this.center,this.zoomLevel);this.map.enableScrollWheelZoom();this.map.addOverlay(this.marker);this.map.addControl(new BMap.NavigationControl());},searchBus:function(H,G){var F=this;this.map.clearOverlays();if(!this._transit){this._transit=new BMap.TransitRoute(this.map,{renderOptions:{map:this.map,panel:this.resultPanel,autoViewport:true},onSearchComplete:function(I){F.onSearchComplete&&F.onSearchComplete(I);}});}var F=this;this._transit.search(H,G);},searchDrive:function(H,G){this.map.clearOverlays();if(!this._driving){this._driving=new BMap.DrivingRoute(this.map,{renderOptions:{map:this.map,panel:this.resultPanel,autoViewport:true},onSearchComplete:function(I){F.onSearchComplete&&F.onSearchComplete(I);}});}var F=this;this._driving.search(H,G);},minusHeight:170},true);})();pmc_exec_time_2750=new Date()*1-pmc_in_script_time_2750;pmc_exec_time_4396=new Date()*1-pmc_in_script_time_4396;
